---
keyword: [多域名访问, HTTP监听, 虚拟终端节点组, 转发策略]
---

# 单个全球加速实例加速访问多个HTTP域名

本教程指导您如何通过一个全球加速GA（Global Accelerator）实例加速访问多个HTTP域名。

开始前，请确保满足以下条件：

-   您的网站已经完成备案。所有对中国内地提供服务的网站都必须先进行ICP备案，才可开通服务。更多信息，请参见[什么是备案]()。
-   目前，全球加速HTTP和HTTPS监听协议白名单开放，请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)申请开通。

本教程以下图场景为例。某公司的总部在北京地域，总部在阿里云上创建了两台服务器，两台服务器均部署了Web服务，并通过不同的HTTP域名对外提供服务。客户端主要分布在杭州地域，该公司的Web服务面临以下挑战：

-   公网传输不稳定，经常出现延迟、抖动、丢包等网络问题。
-   多台服务器通过不同的域名对外提供服务，为网站配置加速服务时，需要分别为每个域名进行加速，成本较高。

您可以部署全球加速服务，并配置HTTP协议监听。全球加速的HTTP协议监听支持配置基于域名的转发策略，通过匹配不同的访问域名，然后将访问请求转发至后端相应的服务器，实现通过一个全球加速实例同时加速访问多个HTTP域名。

![多路径HTTP-HTTP](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5205340161/p211979.png)

当前该公司Web服务器的服务信息以及该公司使用全球加速服务后对客户端访问请求的转发规划如下表所示：

|访问域名|对应转发策略|对应终端节点组|对应服务器|服务器服务协议|服务器服务端口|服务器公网IP|
|----|------|-------|-----|-------|-------|-------|
|www.xxxtest.icu|自定义转发策略|虚拟终端节点组|服务器1|HTTP|80|182.XX.XX.248|
|xxxtest.icu|默认转发策略|默认终端节点组|服务器2|HTTP|80|182.XX.XX.196|

## 配置步骤

![多域名访问配置步骤](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8355000161/p210974.png)

## 步骤一：填写业务方案

在您开始使用全球加速服务前，您需要先购买全球加速实例和基础带宽包。

您可以在全球加速控制台填写自己的业务方案，系统会根据您的业务信息智能推荐您需要购买的全球加速实例和基础带宽包。

1.  登录[全球加速管理控制台](https://ga.console.aliyun.com/list)。

2.  在**实例列表**页面，单击右上角的**购买向导**。

    **说明：** 如果您是首次使用全球加速服务，请忽略该步骤。

    ![购买向导](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p103054.png)

3.  在**智能推荐产品方案，选择以下与您业务相关的选项**区域，根据以下信息填写业务方案。

    -   **您需要加速的地域**：选择要进行加速访问的客户端的地域。本教程选择**杭州**。
    -   **服务所在地域**：选择目标服务器所在的地域。本教程选择**北京**。
    -   **是否有ICP备案**：如果您的后端服务是Web服务，请选择是否有ICP备案。如果您的后端服务不是Web服务，请选择**无备案**。本教程选择**有备案**。

        **说明：** 所有对中国内地提供服务的网站都必须先进行ICP备案，才可开通服务。更多信息，请参见[什么是备案]()。

    -   **服务端部署在**：选择后端服务部署在阿里云还是非阿里云。本教程选择**阿里云**。
    -   **峰值带宽的范围**：输入业务高峰期需要的带宽用量，单位是Mbps。本教程输入**10**。
    -   **最大并发连接数**：最大并发连接数定义了一个全球加速实例能够承载的最大连接数量。当实例上的连接超过规格定义的最大连接数时，新建连接请求将被丢弃。本教程选择**5千**。
4.  单击**点击生成方案**。

    生成方案后，您可以查看系统根据您的业务信息智能推荐的购买方案。

    ![多域名HTTPS访问-购买方案](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1458899061/p210793.png)


## 步骤二：组合购买实例

您可以根据系统推荐的购买方案，组合购买业务所需要的全球加速实例和基础带宽包。

1.  单击**去组合购买**。

2.  在购买页面，根据以下信息购买业务所需要的实例。

    -   **订购时间**：选择实例的订购时间。

        **说明：** 该订购时间是组合购的所有实例的订购时间。例如，您选择订购时间为1年，即全球加速实例和基础带宽包的订购时间都为1年。

    -   **规格**：选择购买全球加速实例的规格。本教程选择**小型Ⅰ（规格单元）**。

        全球加速支持小型Ⅰ、小型Ⅱ、小型Ⅲ、中型Ⅰ、中型Ⅱ、中型Ⅲ六种规格，每种规格提供的服务如下。

        |规格|加速地域个数|最大带宽处理能力|最大并发连接数|
        |--|------|--------|-------|
        |小型Ⅰ|1|20 Mbps|5000|
        |小型Ⅱ|2|40 Mbps|10000|
        |小型Ⅲ|3|60 Mbps|15000|
        |中型Ⅰ|5|100 Mbps|25000|
        |中型Ⅱ|8|160 Mbps|40000|
        |中型Ⅲ|10|200 Mbps|50000|

    -   **带宽类型**：选择购买基础带宽包的带宽类型。本教程选择**标准加速带宽**。

        基础带宽包支持标准加速带宽、增强加速带宽和精品加速带宽三种带宽类型。带宽类型不同，加速类型、加速后端服务和加速范围也不同，如下表所示。

        |带宽类型|加速类型|加速后端服务|加速范围|
        |----|----|------|----|
        |标准加速带宽|阿里云上应用加速|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP

**说明：** 不支持加速经典网络类型的ECS实例和经典网络类型的SLB实例。

|默认加速中国内地区域|
        |增强加速带宽|        -   阿里云上应用加速
        -   阿里云下应用加速
|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP
        -   自定义IP
        -   自定义域名
|默认加速中国内地区域|
        |精品加速带宽|        -   阿里云上应用加速
        -   阿里云下应用加速
|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP
        -   自定义IP
        -   自定义域名
|默认加速全球区域（中国内地到海外区域间的加速通过香港加速点上车）|

        **说明：** 目前，将云服务器ECS和负载均衡SLB作为终端节点的功能白名单开放。如需使用，请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。

    -   **带宽峰值**：选择购买基础带宽包的带宽峰值。本教程选择**10** Mb。
3.  单击**立即购买**并完成支付。

4.  购买完成后，请将购买的基础带宽包绑定到全球加速实例上。具体操作，请参见[绑定基础带宽包](/cn.zh-CN/用户指南/基础带宽包/绑定基础带宽包.md)。

5.  记录全球加速实例CNAME地址。

    客户端通过域名访问后端服务时，需要您在DNS解析平台将域名指向全球加速实例的CNAME上，客户端才能接入全球加速，享受加速服务。在您购买全球加速实例后，系统会自动为全球加速实例分配一个CNAME地址，此处需要您记录下您的全球加速实例CNAME地址，用于后续配置DNS解析记录。您可以在**实例列表**页面，查看您的CNAME地址。

    ![多域名HTTPS访问-CNAME](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1458899061/p210811.png)


## 步骤三：添加加速区域

购买业务所需要的实例后，您便可以添加加速区域，指定客户端所在地域并为其分配带宽，以便其接入全球加速服务。

1.  在**实例列表**页面，找到已经购买的全球加速实例，单击其实例ID。

2.  在实例详情页面，单击**加速区域**页签，然后在**华东**页签下单击**添加接入地域**。

    关于加速区域及地域的对应关系，请参见[加速区域概述](/cn.zh-CN/用户指南/加速区域/加速区域概述.md)。

3.  在**添加加速区域**对话框，根据以下信息配置加速地域，然后单击**确定**。

    -   **地域**：选择需要访问后端Web服务的客户端所属的地域。本教程选择**杭州**。
    -   **带宽**：选择允许的访问带宽。本教程输入**10** Mbps。
    -   **IP地址协议**：选择客户端接入全球加速服务的IP地址协议。本教程选择**IPv4**。

        接入地域添加成功后，全球加速会为接入地域分配一个可公网访问的IPv4地址，用来加速客户端的访问。


## 步骤四：添加监听

监听负责检查连接请求。系统会根据您指定的端口和协议接受来自客户端的入站请求。

1.  在实例详情页，单击**监听**页签，然后单击**添加监听**。

2.  在**配置监听和协议**页面，根据以下信息配置监听。

    -   **监听名称**：输入监听的名称。

        名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。

    -   **协议**：选择监听的协议类型。本教程选择**HTTP**。
    -   **端口**：指定用来接收请求并向终端节点进行转发的监听端口。本教程输入**80**。

        在您选择HTTP或HTTPS监听协议时，端口只能设置一个固定端口，端口值范围：1~65499。

    -   **客户端亲和性**：选择是否保持客户端亲和性。保持客户端亲和性，即客户端访问有状态的应用程序时，可以将来自同一客户端的所有请求都定向到同一终端节点。本教程选择**源IP**。
3.  单击**下一步**配置终端节点组。


## 步骤五：配置终端节点组

每个监听都需要关联终端节点组，通过指定要分发访问请求的地域，将终端节点组与监听关联。关联后，全球加速通过监听接受访问请求，并根据转发策略将访问请求分配到指定终端节点组内的最佳终端节点上。

对于HTTP协议的监听，支持配置默认终端节点组和虚拟终端节点组。其中：

-   默认终端节点组：创建监听时配置的终端节点组为默认终端节点组，并且系统自动为默认终端节点组生成一条默认转发策略，未匹配其他转发策略的访问请求将通过默认转发策略被发送至默认终端节点组上。
-   虚拟终端节点组：在您创建监听后，您可以在终端节点组页面创建虚拟终端节点组，并为其配置相应的转发策略。如果访问请求满足转发策略中转发条件，则全球加速会将访问请求转发至虚拟终端节点组中的最佳终端节点上。

1.  配置默认终端节点组。

    1.  在**配置终端节点**页面，根据以下信息配置默认终端节点组。

        ![HTTP-HTTP默认EPG](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5205340161/p212671.png)

        -   **节点组名称**：输入节点组名称。

            名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。

        -   **地域**：选择终端节点组所属的地域，即请求要访问的目标服务器的所属地域。

            本教程选择**北京**。

        -   **后端服务部署在**：选择后端服务部署在阿里云还是非阿里云。

            本教程选择**阿里云**。

        -   **保持客户端源IP**：HTTP协议的监听默认开启保持客户端源IP功能，支持后端服务查看客户端源IP地址。更多信息，请参见[保持客户端源IP](/cn.zh-CN/监控与运维/保持客户端源IP.md)。

            **说明：** 目前，保持客户端源IP功能白名单开放，如需使用请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。

        -   **终端节点配置**
            -   **后端服务类型**：本教程选择**阿里云公网IP**。
            -   **后端服务**：输入要加速的后端服务的IP地址。本教程输入服务器2的公网IP地址182.XX.XX.196。
            -   **权重**：输入终端节点的权重，权重取值范围：0~255。全球加速根据您配置的权重按比例将流量路由到终端节点。

                **说明：** 如果某个终端节点的权重设置为0，全球加速将终止向该终端节点分发流量，请您谨慎操作。

        -   **后端服务协议**：选择后端服务器提供Web服务时使用的协议。本教程选择默认值**HTTP**。
    2.  单击**下一步**审核配置，确认无误后，再单击**提交**完成配置。

2.  配置虚拟终端节点组。

    1.  在**监听**页面，找到目标监听实例，单击**默认终端节点组ID/名称**列下的实例ID。

    2.  在**终端节点组**页面，单击**添加虚拟终端节点组**。

    3.  在**添加虚拟终端节点组**对话框，根据以下信息进行配置，然后单击**创建**。

        -   **节点组名称**：输入节点组名称。

            名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。

        -   **地域**：选择终端节点组所属的地域，即请求要访问的目标服务器的所属地域。

            本教程选择**北京**。

        -   **后端服务部署在**：选择后端服务部署在阿里云还是非阿里云。

            本教程选择**阿里云**。

        -   **保持客户端源IP**：HTTP协议的监听默认开启保持客户端源IP功能，支持后端服务查看客户端源IP地址。更多信息，请参见[保持客户端源IP](/cn.zh-CN/监控与运维/保持客户端源IP.md)。

            **说明：** 目前，保持客户端源IP功能白名单开放，如需使用请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。

        -   **终端节点配置**
            -   **后端服务类型**：本教程选择**阿里云公网IP**。
            -   **后端服务**：输入要加速的后端服务的IP地址。本教程输入服务器1的公网IP地址182.XX.XX.248。
            -   **权重**：输入终端节点的权重，权重取值范围：0~255。全球加速根据您配置的权重按比例将流量路由到终端节点。

                **说明：** 如果某个终端节点的权重设置为0，全球加速将终止向该终端节点分发流量，请您谨慎操作。

        -   **后端服务协议**：选择后端服务器提供Web服务使用的协议。本教程选择默认值**HTTP**。

## 步骤六：添加转发策略

基于HTTP协议的监听支持配置转发策略。在您创建HTTP协议监听后系统自动创建一条默认转发策略指向默认值终端节点组。您可以创建自定义转发策略指向虚拟终端节点组。

转发策略可以通过域名或路径匹配访问请求，在满足匹配条件后，HTTP协议监听将访问请求转发至对应终端节点组的最佳终端节点中。其中HTTP协议监听接受到访问请求后，会优先匹配自定义转发策略，如果访问请求未匹配到任何自定义转发策略，将会直接通过默认转发策略被转发至默认终端节点组中。

本步骤为服务器1对应的虚拟终端节点组创建自定义转发策略。

1.  在监听详情页面，单击**转发策略**。

2.  在**转发策略**页签下，单击**插入新策略**。

3.  在**插入新策略**区域，根据以下信息配置转发策略。

    -   **策略名称**：输入转发策略的名称。

        名称长度为2~128个英文或中文字符，必须以大小写字母或中文开头，可包含数字、半角句号（.）、下划线（\_）和短划线（-）。

    -   **如果（条件全部匹配）**：选择转发条件的匹配方式。本教程选择**域名**，并输入要匹配的域名www.xxxtest.icu。

        域名长度为3~128个字符，允许包含字母、数字、下划线（-）和半角句号（.），支持使用星号（\*）和半角问号（?）作为通配符。

    -   **那么转发至虚拟终端节点组**：选择终端节点组。本教程选择刚刚创建的虚拟终端节点组。
4.  单击**确定**。

    ![多域名HTTPS访问-转发策略](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3158999061/p210881.png)


## 步骤七：配置DNS解析

您需要将要访问的域名通过DNS解析到全球加速的CNAME地址，访问请求才能转发到全球加速，实现加速效果。本教程以阿里云云解析DNS为例，为您介绍如何修改DNS解析。

**说明：** 如果您使用的DNS解析服务为非阿里云云解析DNS，请登录您的DNS服务商系统修改网站域名的解析记录。

1.  登录[阿里云云解析DNS控制台](https://dns.console.aliyun.com)。

2.  在**域名解析**页面，找到目标域名，单击**操作**列下的**解析设置**。

3.  在**解析设置**页面，找到要修改的解析记录，单击**操作**列下的**修改**。

4.  在**修改记录**对话框，选择**记录类型**为**CNAME**，并将**记录值**修改为步骤二组合购买实例后分配的CNAME地址。更多信息，请参见[步骤二：组合购买实例](#section_4p1_rqj_37d)。

    ![多域名HTTPS-DNS解析](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3443000161/p210885.png)

5.  单击**确认**。


## 步骤八：访问测试

完成以下操作，测试客户端是否可以通过不同域名访问部署在北京的Web服务，并实现访问加速。

**说明：** 本教程以Linux操作系统为例进行测试。不同类型的操作系统测试命令可能会有差异，具体测试命令请参见您操作系统的操作指南。

1.  通过域名www.xxxtest.icu访问后端Web服务，并查看加速效果。

    1.  执行以下命令，测试网站连通性。

        ```
        curl http://<网站域名>
        ```

        ![http多域名-server1结果](../images/p223985.png "访问结果")

    2.  执行以下命令，查看数据传输情况。

        ```
        curl -o /dev/null -s -w "time_connect: %{time_connect}\ntime_starttransfer: %{time_starttransfer}\ntime_total: %{time_total}\n" "http://<网站域名>"
        ```

        其中：

        -   time\_connect：连接时间，从开始到建立TCP连接完成所用的时间。
        -   time\_starttransfer：开始传输时间。在客户端发出请求后，到后端服务器响应第一个字节所用的时间。
        -   time\_total：连接总时间。客户端发出请求后，到后端服务器响应会话所用的时间。
        ![HTTP-HTTPserver2加速前](../images/p212780.png "加速前的访问传输情况")

        ![HTTP-HTTPserver2加速后](../images/p212775.png "加速后的访问传输情况")

        **说明：** 使用全球加速服务后的加速效果以您的实际业务测试为准。

2.  通过域名xxxtest.icu访问后端Web服务，并查看加速效果。

    1.  执行以下命令，测试网站连通性。

        ```
        curl http://<网站域名>
        ```

        ![HTTP多域名-server2访问结果](../images/p223991.png "访问结果")

    2.  执行以下命令，查看数据传输情况。

        ```
        curl -o /dev/null -s -w "time_connect: %{time_connect}\ntime_starttransfer: %{time_starttransfer}\ntime_total: %{time_total}\n" "http://<网站域名>"
        ```

        其中：

        -   time\_connect：连接时间，从开始到建立TCP连接完成所用的时间。
        -   time\_starttransfer：开始传输时间。在客户端发出请求后，到后端服务器响应第一个字节所用的时间。
        -   time\_total：连接总时间。客户端发出请求后，到后端服务器响应会话所用的时间。
        ![server2访问后](../images/p210938.png "加速前的访问传输情况")

        ![http多域名-server2加速后](../images/p223994.png "加速后的访问传输情况")

        **说明：** 使用全球加速服务后的加速效果以您的实际业务测试为准。


