# 全球加速联动内容分发网络实现回源加速

全球加速（GA）依托阿里巴巴优质BGP带宽和全球传输网络，通过联动内容分发网络（CDN），帮助您快速构建全球CDN回源网络，保障CDN业务实现动态内容的全面加速。

开始前，请确保您已经注册了阿里云账号。如未注册，请先完成[账号注册](https://account.aliyun.com/register/register.htm)。

本文以下图场景为例。某Web服务部署在美国（硅谷）地域的阿里云上，后端服务通过阿里云弹性公网IP对外提供Web服务，转发端口为TCP 80端口，客户端集中分布在中国（香港）。因跨国公网不稳定，中国香港客户端访问美国（硅谷）地域的Web服务经常出现延迟、抖动、丢包等网络问题。

您可以为Web服务部署CDN，CDN可以帮助您构建边缘节点缓存，提升业务访问体验。同时CDN联动全球加速，依托阿里巴巴优质BGP带宽和全球传输网络，帮助您快速构建全球CDN回源网络，保障CDN业务实现动态内容的全面加速。

![配置场景](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p135023.png)

## 配置步骤

![配置步骤](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p135024.png)

## 步骤一：填写加速业务

您可以在全球加速控制台填写自己的加速业务，系统会根据您的加速业务智能推荐需要购买的全球加速实例和基础带宽包。

完成以下操作，填写加速业务。

1.  登录[全球加速管理控制台](https://ga.console.aliyun.com/list)。

2.  在**实例列表**页面，单击右上角的**购买向导**。

    **说明：** 如果您是首次使用全球加速服务，请忽略该步骤。

    ![购买向导](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p103054.png)

3.  在**智能推荐产品方案，选择以下与您业务相关的选项**区域，根据以下信息填写加速业务。

    -   **您需要加速的地域**：选择需要进行访问加速的地域。本示例选择**中国（香港）**。
    -   **服务所在地域**：选择目标服务器所在的地域。本示例选择**美国（硅谷）**。
    -   **是否有ICP备案**：如果您的加速服务是Web服务，请选择是否有ICP备案。如果加速服务不是Web服务，请选择**无备案**。本示例选择**无备案**。

        **说明：** 所有对中国内地（大陆）提供服务的网站都必须先进行ICP备案，才可开通服务。详细信息，请参见[什么是备案]()。

    -   **服务端部署在**：选择后端服务部署在阿里云还是非阿里云。本示例选择**阿里云**。
    -   **峰值带宽的范围**：输入业务高峰期需要的带宽用量，单位是Mbps。本示例输入**10**。
    -   **最大并发连接数**：最大并发连接数定义了一个全球加速实例能够承载的最大连接数量。当实例上的连接超过规格定义的最大连接数时，新建连接请求将被丢弃。本示例选择**5千**。
4.  单击**点击生成方案**。

    生成方案后，您可以查看系统根据您的加速业务智能推荐的加速方案。

    ![加速方案](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p134878.png)


## 步骤二：组合购买实例

您可以根据系统推荐的加速方案，组合购买加速业务所需要的全球加速实例和基础带宽包。

完成以下操作，组合购买实例。

1.  单击**去组合购买**。

    ![组合购买](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p134881.png)

2.  在购买页面，根据以下信息购买加速业务所需要的实例。

    -   **订购时长**：选择实例的订购时长。

        **说明：** 该订购时长是组合购的所有实例的订购时长。例如，您选择订购时长为1年，即全球加速实例和基础带宽包的订购时长都为1年。

    -   **规格**：选择购买全球加速实例的规格。 本示例选择**小型Ⅰ**。

        全球加速支持小型Ⅰ、小型Ⅱ、小型Ⅲ、中型Ⅰ、中型Ⅱ、中型Ⅲ六种规格，每种规格提供的加速服务如下表所示。

        |规格|加速地域个数|最大带宽处理能力|最大并发连接数|
        |--|------|--------|-------|
        |小型Ⅰ|1|20 Mbps|5000|
        |小型Ⅱ|2|40 Mbps|10000|
        |小型Ⅲ|3|60 Mbps|15000|
        |中型Ⅰ|5|100 Mbps|25000|
        |中型Ⅱ|8|160 Mbps|40000|
        |中型Ⅲ|10|200 Mbps|50000|

    -   **带宽类型**：选择购买基础带宽包的带宽类型。本示例选择**精品加速带宽**。

        基础带宽包支持标准加速带宽、增强加速带宽和精品加速带宽三种带宽类型。带宽类型不同，加速类型、加速后端服务和加速范围也不同，如下表所示。

        |带宽类型|加速类型|加速后端服务|加速范围|
        |----|----|------|----|
        |标准加速带宽|阿里云上应用加速|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP

**说明：** 不支持加速经典网络类型的ECS实例和经典网络类型的SLB实例。

|默认加速中国内地区域|
        |增强加速带宽|        -   阿里云上应用加速
        -   阿里云下应用加速
|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP
        -   自定义IP
        -   自定义域名
|默认加速中国内地区域|
        |精品加速带宽|        -   阿里云上应用加速
        -   阿里云下应用加速
|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP
        -   自定义IP
        -   自定义域名
|默认加速全球区域（中国内地到海外区域间的加速通过中国香港加速点上车）|

        **说明：** 目前，将云服务器和负载均衡作为终端节点的功能白名单开放。如需使用，请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。

    -   **带宽峰值**：选择购买基础带宽包的带宽峰值。本示例选择**10Mb**。
3.  单击**立即购买**并完成支付。


购买完成后，系统会为全球加速实例分配一个CNAME，用于解析要加速的后端服务。

![CNAME](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p134944.png)

基础带宽包会自动绑定到全球加速实例上。

![绑定基础带宽包](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p134884.png)

## 步骤三：添加加速区域

购买加速业务所需要的实例后，您便可以添加加速区域，指定访问后端服务的客户端的所在地域并分配加速带宽。

完成以下操作，添加加速区域。

1.  在**实例列表**页面，找到步骤二购买的全球加速实例，单击其实例ID。

2.  在实例详情页，单击**加速区域**页签，然后单击**添加加速区域**。

3.  在**添加加速区域**对话框，根据以下信息配置加速区域，然后单击**确定**。

    -   **加速区域**：选择需要进行访问加速的区域。本示例选择**亚太**。
    -   **地域**：选择访问加速服务的客户端的所属地域。本示例选择**中国（香港）**。
    -   **带宽**：选择加速服务的地域带宽。本示例输入**10**Mbps。
    -   **IP地址协议**：选择接入全球加速服务的IP地址协议。本示例选择**IPv4**。

        **说明：** 目前，IPv6客户端接入全球加速服务的功能白名单开发。如需使用，请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。


加速区域添加成功后，全球加速会为每个接入地域分配一个加速IP，用来加速客户端访问。

![添加加速区域](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p134913.png)

## 步骤四：添加监听

监听负责检查连接请求。系统会根据您指定的端口和协议转发来自客户端的入站连接。

完成以下操作，为全球加速实例添加监听。

1.  在实例详情页，找到单击**监听**页签，然后单击**添加监听**。

2.  在**监听&协议**页面，根据以下信息配置监听。

    -   **监听名称**：输入监听的名称。 名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短横线（-）。
    -   **协议**：选择监听的协议类型。本示例选择**TCP**。
    -   **端口**：指定用来接收请求并向终端节点进行转发的监听端口，端口取值范围：1~65499。本示例输入**80**。
    -   **客户端亲和性**：选择是否保持客户端亲和性。保持客户端亲和性，即客户端访问有状态的应用程序时，可以将来自同一客户端的所有请求都定向到同一终端节点。本示例选择**源IP**。
    ![监听](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7796363161/p84395.png)

3.  单击**下一步**。


## 步骤五：设置终端节点组

每个监听都关联一个终端节点组，通过指定要分发流量的地域，将终端节点组与监听关联。关联后，全球加速会将流量分配到与监听关联的终端节点组内的最佳终端节点。

完成以下操作，设置终端节点组。

1.  在**终端节点组**页面，根据以下信息配置终端节点组。

    -   **节点组名称**：输入节点组名称。名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短横线（-）。
    -   **地域**：选择终端节点组所属的地域，即请求要访问的目标服务器的所属地域。本示例选择**美国（硅谷）**。
    -   **后端服务部署在**：选择后端服务部署在阿里云还是非阿里云。本示例选择**阿里云**。
    -   **保持客户端源IP**：选择开启或关闭保持客户端源IP。开启后，后端服务器可以通过该功能获取客户端源IP。本示例选择关闭保持客户端源IP。

        **说明：** 目前，保持客户端源IP功能白名单开放，如需使用请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。

    -   **终端节点**：配置终端节点。
        -   **后端服务类型**：选择**阿里云弹性IP**。
        -   **后端服务**：选择要加速的后端服务的弹性IP。
        -   **权重**：输入终端节点的权重，权重取值范围：0~255。全球加速根据您配置的权重按比例将流量路由到终端节点。

            **说明：** 如果某个终端节点的权重设置为0，全球加速将终止向该终端节点分发流量，请您谨慎操作。

    ![配置终端节点组](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p129395.png)

2.  单击**下一步**查看监听和终端节点配置，确认无误后，再单击**下一步**。


## 步骤六：开通CDN服务

内容分发网络（CDN）分担源站压力，避免网络拥塞，确保在不同区域、不同场景下加速网站内容的分发，提高资源访问速度。使用CDN服务前，请先开通CDN服务。

**说明：** 如果您已经开通了CDN服务，请忽略此步骤。

完成以下操作，开通CDN服务。

1.  登录[阿里云CDN产品详细页](https://www.aliyun.com/product/cdn)。

2.  单击**立即开通**。

3.  在开通页，根据业务需要选择计费类型。

    CDN的计费详情，请参见[CDN详细价格信息](https://www.aliyun.com/price/product?spm=a2c4g.11186623.2.10.1b444ee22Dxy8y#/cdn/detail)。

4.  选中**内容分发网络CDN服务协议**，然后单击**立即开通**。

5.  开通成功后，单击**管理控制台**，进入CDN管理控制台。


## 步骤七：添加加速域名

CDN通过加速域名将源站上的资源缓存到CDN的加速节点，实现资源访问加速。

完成以下操作，添加加速域名。

1.  在左侧导航栏，单击**域名管理**。

2.  在**域名管理**页面，单击**添加域名**。

3.  在**添加域名**页面，根据以下信息配置加速域名。

    -   **加速域名**：输入Web服务域名。本示例输入**www.example.com**。
    -   **资源分组**：选择加速域名所属的资源组。

        **说明：** 新开通的CDN服务，不显示**资源分组**。如果您需要使用资源组功能，请登录[资源管理控制台](https://resourcemanager.console.aliyun.com)，根据界面提示开通资源组服务，并创建资源组。详细信息，请参见[创建资源组](https://help.aliyun.com/document_detail/94485.html)。

    -   **业务类型**：选择您网站的业务类型。

        -   **图片小文件**：如果您网站的加速内容多为小型的静态资源 （例如小文件、图片、网页样式文件等），推荐您选择该业务类型。详细信息，请参见[图片小文件](/cn.zh-CN/产品简介/应用场景/图片小文件.md)。
        -   **大文件下载**：如果您网站的加速内容为较大的文件（大于20MB的静态文件），例如游戏安装包、应用更新、手机ROM升级、应用程序包下载等场景，推荐选择该业务类型。详细信息，请参见[大文件下载](/cn.zh-CN/产品简介/应用场景/大文件下载.md)。
        -   **视音频点播**：如果您网站的加速内容为音频或视频文件，例如音乐、视频的点播业务场景，推荐选择该业务类型。详细信息，请参见[视音频点播](/cn.zh-CN/产品简介/应用场景/视音频点播.md)。
        -   **全站加速**：如果您的网站含有大量动静态混合内容，且较多为动态资源请求，您可以使用全站加速。详细信息，请参见[全站加速](/cn.zh-CN/产品简介/应用场景/全站加速.md)。
        -   **安全加速**：如果您的网站易遭受攻击且必须兼顾加速的业务场景，则可以使用安全加速功能，提升全站安全性。 详细信息，请参见[安全加速](/cn.zh-CN/产品简介/应用场景/安全加速.md)。
        本示例选择**图片小文件**。

    -   **源站信息**：配置CDN的源站信息。

        本示例选择**源站域名**，然后输入组合购买实例后系统为全球加速实例分配的CNAME。详细信息，请参见[步骤二：组合购买实例](#section_4f2_oon_4nc)。

    -   **端口**：选择网站访问端口。

        -   **80端口**：以HTTP协议访问资源。
        -   **443端口**：以HTTPS协议访问资源。
        本示例选择**80端口**。

    -   **加速区域**：选择要加速的区域。本示例选择**全球（不包含中国内地）**。

        **说明：** 加速区域含中国内地时，加速域名必须备案。详细信息，请参见[什么是备案]()。

4.  单击**下一步**，然后单击**返回域名列表**。

    加速域名添加成功后，阿里云CDN会分配对应的CNAME地址。

    ![cname](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9472029951/p99749.png)


## 步骤八：配置DNS解析

域名添加成功后，您需要将DNS解析到CDN，访问加速域名的请求才能转发到CDN节点，实现加速效果。本示例以阿里云云解析DNS为例，为您介绍如何配置DNS解析。

**说明：** 如果您使用的DNS解析服务为非阿里云云解析DNS，请登录您的DNS服务商系统修改网站域名的解析记录。

完成以下操作，配置DNS解析。

1.  登录[阿里云云解析DNS控制台](https://dns.console.aliyun.com)。

2.  在**域名解析**页面，找到目标域名，单击**操作**列下的**解析设置**。

3.  在**解析设置**页面，找到要修改的解析记录，单击**操作**列下的**修改**。

4.  在**修改记录**对话框，选择**记录类型**为**CNAME**，并将**记录值**修改为步骤七添加加速域名后分配的CNAME地址。详细信息，请参见[步骤七：添加加速域名](#section_vp5_tl2_t5h)。

    ![修改记录](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9472029951/p135152.png)

5.  单击**确定**。


## 步骤九：访问测试

在接入地域（本示例为中国香港）下，使用Windows电脑测试全球加速联动CDN后的加速效果。

完成以下操作，测试加速效果。

1.  在浏览器中使用Web服务域名（本示例为www.example.com）访问美国（硅谷）地域部署的Web服务。

    经测试，可以通过域名www.example.com访问美国（硅谷）地域部署的Web服务。

    ![访问测试](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9472029951/p135008.png)

2.  执行以下命令，查看数据包延迟情况。

    `curl -o /dev/null -s -w "time_connect: %{time_connect}\ntime_starttransfer: %{time_starttransfer}\ntime_total: %{time_total}\n" "http[s]://<Web服务域名>[:<端口>]"`

    其中：

    -   time\_connect：连接时间，从开始到建立TCP连接完成所用的时间。
    -   time\_starttransfer：开始传输时间。在客户端发出请求后，到后端服务器响应第一个字节所用的时间。
    -   time\_total：连接总时间。客户端发出请求后，到后端服务器响应会话所用的时间。
    经测试，全球加速联动CDN后，降低了中国（香港）客户端访问美国硅谷Web服务的延迟。

    ![加速前，访问延迟情况](../images/p76785.png "加速前的访问延迟情况")

    ![延时测试](../images/p135011.png "加速后的访问延迟情况")

    **说明：** 全球加速联动CDN的加速效果以您的实际业务测试为准。


