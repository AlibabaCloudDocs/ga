# 全球加速实现IPv6转换服务

本教程指导您如何通过全球加速实现IPv6转换服务，满足IPv6客户端访问后端IPv4服务的需求。

开始前，请确保满足以下条件：

-   您已经注册了阿里云账号。如未注册，请先完成[账号注册](https://account.aliyun.com/register/register.htm)。
-   目前，仅华北2（北京）、华东1（杭州）、华东2（上海）、华南1（深圳）和中国（香港）地域支持IPv6接入全球加速服务，且需申请白名单。如需使用，请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。
-   您后端的IPv4服务已经配置了公网IPv4地址。

某些企业现有的IT系统部署在本地IDC机房，IDC机房为纯IPv4网络，企业因业务发展需求，需要面向IPv6客户端提供服务。但是，使企业现有IT系统支持IPv6是一个复杂的系统工程，改造难度大，周期长，通常为企业的一个痛点。现在，全球加速产品提供IPv6转换服务，在不改动企业现有IT系统的情况下，可快速实现IPv6转换。企业IPv6客户端发起的访问请求经过全球加速转换后被直接发送至后端的IPv4服务器，快速实现服务访问。同时， 针对一些IT系统部署在云上的企业，也同样可以通过全球加速快速支持IPv6客户端访问。

本教程以下列场景为例指导您如何部署全球加速IPv6转换服务。北京某公司现有的IT系统部署在本地IDC机房，IDC机房为纯IPv4网络。因业务扩展需要，企业现计划使用全球加速产品快速实现IPv6转换，满足IPv6客户端访问后端IPv4 Web服务的需求。

![IPV6转换场景图](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5029415061/p181764.png)

## 配置步骤

![配置步骤](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0865034061/p178541.png)

## 步骤一：填写业务方案

在您开始使用全球加速服务前，您需要先购买全球加速实例和基础带宽包。

您可以在全球加速控制台填写自己的业务方案，系统会根据您的业务信息智能推荐您需要购买的全球加速实例和基础带宽包。

完成以下操作，填写业务方案。

1.  登录[全球加速管理控制台](https://ga.console.aliyun.com/list)。

2.  在**实例列表**页面，单击右上角的**购买向导**。

    **说明：** 如果您是首次使用全球加速服务，请忽略该步骤。

    ![购买向导](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8472029951/p103054.png)

3.  在**智能推荐产品方案，选择以下与您业务相关的选项**区域，根据以下信息填写业务方案。

    -   **您需要加速的地域**：选择要进行Web服务访问的IPv6客户端的地域。本教程选择**北京**。
    -   **服务所在地域**：选择目标服务器所在的地域。本教程选择**北京**。
    -   **是否有ICP备案**：如果您的后端服务是Web服务，请选择是否有ICP备案。如果您的后端服务不是Web服务，请选择**无备案**。本教程选择**有备案**。

        **说明：** 所有对中国内地提供服务的网站都必须先进行ICP备案，才可开通服务。更多信息，请参见[什么是备案]()。

    -   **服务端部署在**：选择后端服务部署在阿里云还是非阿里云。本教程选择**非阿里云**。
    -   **峰值带宽的范围**：输入业务高峰期需要的带宽用量，单位是Mbps。本教程输入**10**。
    -   **最大并发连接数**：最大并发连接数定义了一个全球加速实例能够承载的最大连接数量。当实例上的连接超过规格定义的最大连接数时，新建连接请求将被丢弃。本教程选择**5千**。
4.  单击**点击生成方案**。

    生成方案后，您可以查看系统根据您的业务信息智能推荐的购买方案。

    ![IPV6转换服务推荐方案](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6029415061/p181766.png)


## 步骤二：组合购买实例

您可以根据系统推荐的购买方案，组合购买业务所需要的全球加速实例和基础带宽包。

完成以下操作，组合购买实例。

1.  单击**去组合购买**。

    ![IPV6转换服务推荐方案购买入口](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6029415061/p181767.png)

2.  在购买页面，根据以下信息购买业务所需要的实例。

    -   **订购时间**：选择实例的订购时间。

        **说明：** 该订购时间是组合购的所有实例的订购时间。例如，您选择订购时间为1年，即全球加速实例和基础带宽包的订购时间都为1年。

    -   **规格**：选择购买全球加速实例的规格。 本教程选择**小型Ⅰ（规格单元）**。

        全球加速支持小型Ⅰ、小型Ⅱ、小型Ⅲ、中型Ⅰ、中型Ⅱ、中型Ⅲ六种规格，每种规格提供的服务如下。

        |规格|加速地域个数|最大带宽处理能力|最大并发连接数|
        |--|------|--------|-------|
        |小型Ⅰ|1|20 Mbps|5000|
        |小型Ⅱ|2|40 Mbps|10000|
        |小型Ⅲ|3|60 Mbps|15000|
        |中型Ⅰ|5|100 Mbps|25000|
        |中型Ⅱ|8|160 Mbps|40000|
        |中型Ⅲ|10|200 Mbps|50000|

    -   **带宽类型**：选择购买基础带宽包的带宽类型。本教程选择**增强加速带宽**。

        基础带宽包支持标准加速带宽、增强加速带宽和精品加速带宽三种带宽类型。带宽类型不同，加速类型、加速后端服务和加速范围也不同，如下表所示。

        |带宽类型|加速类型|加速后端服务|加速范围|
        |----|----|------|----|
        |标准加速带宽|阿里云上应用加速|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP

**说明：** 不支持加速经典网络类型的ECS实例和经典网络类型的SLB实例。

|默认加速中国内地区域|
        |增强加速带宽|        -   阿里云上应用加速
        -   阿里云下应用加速
|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP
        -   自定义IP
        -   自定义域名
|默认加速中国内地区域|
        |精品加速带宽|        -   阿里云上应用加速
        -   阿里云下应用加速
|        -   云服务器ECS
        -   负载均衡SLB
        -   阿里云公网IP
        -   自定义IP
        -   自定义域名
|默认加速全球区域（中国内地到海外区域间的加速通过中国香港加速点上车）|

        **说明：** 目前，将云服务器和负载均衡作为终端节点的功能白名单开放。如需使用，请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。

    -   **带宽峰值**：选择购买基础带宽包的带宽峰值。本教程选择**10 Mb**。
3.  单击**立即购买**并完成支付。


购买完成后，基础带宽包会自动绑定到加速实例上。

## 步骤三：添加加速区域

购买业务所需要的实例后，您便可以添加加速区域，指定IPv6客户端所在地域并为其分配带宽，同时获得加速IP。

完成以下操作，添加加速区域。

1.  在**实例列表**页面，找到步骤二购买的全球加速实例，单击其实例ID。

2.  在实例详情页，单击**加速区域**页签，然后单击**添加加速区域**。

3.  在**添加加速区域**对话框，根据以下信息配置加速区域，然后单击**确定**。

    -   **加速区域**：选择需要访问后端IPv4 Web服务的区域。本教程选择**华北**。
    -   **地域**：选择需要访问后端IPv4 Web服务的IPv6客户端所属的地域。本教程选择**北京**。
    -   **带宽**：选择允许的访问带宽。本教程输入**10** Mbps。
    -   **IP地址协议**：选择客户端接入全球加速服务的IP地址协议。本教程选择**IPv6**。

        加速区域添加成功后，全球加速会为接入地域分配一个可公网访问的IPv6地址作为加速IP，IPv6客户端通过该加速IP访问后端IPv4 Web服务。

        ![IPv6转换服务加速IP](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6029415061/p181777.png)


## 步骤四：配置监听

全球加速监听负责检查连接请求。系统会根据您指定的端口和协议转发来自客户端的入站连接。

完成以下操作，为全球加速实例添加监听。

1.  在实例详情页，单击**监听**页签，然后单击**添加监听**。

2.  在**配置监听&协议**页面，根据以下信息配置监听。

    -   **监听名称**：输入监听的名称。

        名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。

    -   **协议**：选择监听的协议类型。本教程选择**TCP**。
    -   **端口**：指定用来接收请求并向终端节点进行转发的监听端口，端口取值范围：1~65499。本教程输入**80**。
    -   **客户端亲和性**：选择是否保持客户端亲和性。本教程选择**源IP**。

        保持客户端亲和性，即客户端访问有状态的应用程序时，可以将来自同一客户端的所有请求都定向到同一终端节点。

    ![配置监听](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6518034061/p178548.png)

3.  单击**下一步**配置终端节点组。


## 步骤五：设置终端节点组

每个监听都关联一个终端节点组，通过指定要分发客户端请求的地域，将终端节点组与监听关联。关联后，全球加速会将客户端请求分配到与监听关联的终端节点组内的最佳终端节点。

完成以下操作，设置终端节点组。

1.  在**终端节点组**页面，根据以下信息配置终端节点组。

    -   **节点组名称**：输入节点组名称。

        名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。

    -   **地域**：选择终端节点组所属的地域，即客户端请求要访问的目标IPv4 Web服务器的所属地域。本教程选择**北京**。
    -   **后端服务部署在**：选择后端IPv4 Web服务部署在阿里云还是非阿里云。本教程选择**非阿里云**。
    -   **保持客户端源IP**：选择开启或关闭保持客户端源IP。开启后，后端服务器可以通过该功能获取客户端源IP。本教程选择关闭保持客户端源IP。

        **说明：** 目前，保持客户端源IP功能白名单开放，如需使用请[提交工单](https://selfservice.console.aliyun.com/ticket/category/ga/today)。更多信息，请参见[保持客户端源IP](/cn.zh-CN/监控与运维/保持客户端源IP.md)。

    -   **终端节点**：配置终端节点。
        -   **后端服务类型**：选择**自定义IP**。
        -   **后端服务**：输入后端IPv4 Web服务的公网IP地址。
        -   **权重**：输入终端节点的权重，权重取值范围：0~255。全球加速根据您配置的权重按比例将客户端请求路由到终端节点。

            **说明：** 如果某个终端节点的权重设置为0，全球加速将终止向该终端节点分发客户端请求，请您谨慎操作。

    ![终端节点组 ](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6029415061/p178552.png)

2.  单击**下一步**查看监听和终端节点组配置，确认无误后，再单击**下一步**。


## 步骤六：访问测试

完成以下操作，测试访问功能。

1.  在接入地域（本教程为北京），打开IPv6客户端的命令行窗口。

2.  执行以下命令，测试IPv6客户端是否能正常访问后端IPv4 Web服务。

    `curl -6 -g http://[<GA分配的加速IP>]`

    **说明：** 本教程以CentOS操作系统为例进行测试。不同类型的操作系统测试命令会有差异，具体测试命令请参见您操作系统的操作指南。

    经测试，IPv6客户端通过加速IP可以正常访问后端的IPv4 Web服务。

    ![实现IPV6转换](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0865034061/p178530.png)


