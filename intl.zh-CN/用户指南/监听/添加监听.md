---
keyword: [配置监听和协议, 配置SSL证书, 配置终端节点]
---

# 添加监听

创建全球加速实例后，您需要为全球加速实例配置监听。监听负责检查连接请求，然后根据调度算法定义的转发策略将请求流量分发至终端节点。

-   您已经创建了全球加速实例。具体操作，请参见[创建全球加速实例](/intl.zh-CN/用户指南/全球加速实例/创建全球加速实例.md)。
-   目前，HTTP和HTTPS监听协议白名单开放。如需使用，请[提交工单](https://workorder-intl.console.aliyun.com/?spm=5176.11182188.console-base-top.dworkorder.18ae4882n3v6ZW#/ticket/createIndex)
-   如果您要配置HTTPS协议的监听，请确保您已经购买了SSL证书，并申请了该SSL证书。具体操作，请参见[证书选型和购买](https://www.alibabacloud.com/help/zh/doc-detail/28542.htm?spm=a2c63.p38356.b99.28.34582356bpg5Lj)和[提交证书申请](/intl.zh-CN/证书申请/提交证书申请.md)。

## 添加TCP或UDP协议监听

1.  配置监听和协议。

    1.  登录[全球加速管理控制台](https://ga.console.aliyun.com/list)。

    2.  在**实例列表**页面，找到目标全球加速实例，单击**操作**列下的**配置监听**。

    3.  在**监听**页签下，单击**添加监听**。

        **说明：** 如果您是第一次添加监听，请跳过该步骤。

    4.  在**配置监听和协议**页面下，根据以下信息配置监听和协议。

        |配置|说明|
        |--|--|
        |**监听名称**|输入监听的名称。 名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。 |
        |**协议**|选择监听的网络传输协议类型，支持以下协议：         -   **TCP**：TCP协议具有以下特性：
            -   面向连接的协议，可靠性高。在正式收发数据前，必须和对方建立可靠的连接。
            -   基于源地址的会话保持。
            -   在网络层可直接看到来源地址。
            -   数据传输慢。
        -   **UDP**：UDP协议具有以下特性：
            -   面向非连接的协议，可靠性低。在数据发送前不与对方进行三次握手，直接进行数据包发送，不提供差错恢复和数据重传机制。
            -   数据传输快。 |
        |**端口**|用来接收请求并向终端节点进行转发的监听端口，端口取值范围：**1~65499**。每个监听可配置30个监听端口，端口之间使用半角逗号（,）分隔，例如80,90,8080。

如果您的端口为多个连续的端口，您可以使用波浪线（~）表示监听端口范围，例如80~85。

**说明：**

        -   同一全球加速实例下相同监听协议的监听端口不能冲突。
        -   目前，部分地域支持一个监听可配置超过300个监听端口。更多信息，请参见[监听端口](/intl.zh-CN/用户指南/监听/监听概述.md)。 |
        |**客户端亲和性**|选择是否保持客户端亲和性：         -   **源IP**：保持客户端亲和性，即客户端访问有状态的应用程序时，可以将来自同一客户端的所有请求都定向到同一终端节点。
        -   **关闭**：不保持客户端亲和性，即不能确保来自同一客户端的连接请求始终定向到同一终端节点。 |

    5.  单击**下一步**。

2.  配置终端节点组。

    每个监听都有一个与之关联的终端节点组，通过指定要向其分发流量的区域，可以将终端节点组与监听相关联，将流量分配到与监听关联的终端节点组内的最佳终端节点。

    1.  根据以下信息，配置终端节点组以及终端节点。

        |配置|说明|
        |--|--|
        |**节点组名称**|输入终端节点组的名称。 名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。 |
        |**地域**|选择终端节点组所属的地域。|
        |**后端服务部署在**|选择后端服务器部署地。         -   **阿里云**：后端服务器部署在阿里云。
        -   **非阿里云**：后端服务器部署在非阿里云。 |
        |**保持客户端源IP**|开启或关闭保持客户端源IP。 开启后，后端服务器可以通过该功能获取客户端源IP。更多信息，请参见[保持客户端源IP](/intl.zh-CN/监控与运维/保持客户端源IP.md)。

**说明：** 目前，保持客户端源IP功能白名单开放，如需使用请[提交工单](https://workorder-intl.console.aliyun.com/?spm=5176.11182188.console-base-top.dworkorder.18ae4882n3v6ZW#/ticket/createIndex)。 |
        |**终端节点**|终端节点是客户端请求访问的目标主机。您可以根据以下信息配置终端节点：         -   **后端服务类型**：如果您的服务部署在阿里云，您可以选择**阿里云公网IP**、**ECS**或**SLB**；如果您的服务部署在非阿里云，您可以选择**自定义IP**或**自定义域名**。

**说明：**

            -   目前，选择ECS和SLB作为后端服务类型的功能白名单开放。如需使用，请[提交工单](https://workorder-intl.console.aliyun.com/?spm=5176.11182188.console-base-top.dworkorder.18ae4882n3v6ZW#/ticket/createIndex)。
            -   选择ECS和SLB作为后端服务类型，如果服务关联角色不存在，系统会自动创建一个名称为AliyunServiceRoleForGaVpcEndpoint的服务关联角色。更多信息，请参见[AliyunServiceRoleForGaVpcEndpoint](/intl.zh-CN/用户指南/服务关联角色/AliyunServiceRoleForGaVpcEndpoint.md)。
        -   **后端服务**：输入后端服务器提供服务的IP地址或域名。
        -   **权重**：输入终端节点权重，权重取值范围：**0~255**。全球加速根据您配置的权重按比例将流量路由到终端节点。

**说明：** 如果某个终端节点的权重设置为0，全球加速将终止向该终端节点分发流量，请您谨慎操作。

您可以单击**+添加节点**添加多个终端节点，最多添加4个终端节点。 |

    2.  单击**下一步**。

3.  审核配置。

    1.  在**配置审核**页面下，审核配置。

        如果需要修改配置，您可以单击对应区域中的**修改**，返回到之前的配置页面进行修改。

    2.  确认无误后，单击**提交**，完成监听配置。


## 添加HTTP或HTTPS协议监听

1.  配置监听和协议。

    1.  登录[全球加速管理控制台](https://ga.console.aliyun.com/list)。

    2.  在**实例列表**页面，找到目标全球加速实例，单击**操作**列下的**配置监听**。

    3.  在**监听**页签下，单击**添加监听**。

        **说明：** 如果您是第一次添加监听，请跳过该步骤。

    4.  在**配置监听和协议**页面下，根据以下信息配置监听和协议。

        |配置|说明|
        |--|--|
        |**监听名称**|输入监听的名称。名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。 |
        |**协议**|选择监听的网络传输协议类型：         -   **HTTPS**：HTTPS协议具有以下特性：
            -   面向连接的协议，可靠性高。在正式收发数据前，必须和对方建立可靠的连接。
            -   通过绑定服务器SSL证书，保证数据的高可靠性。
            -   数据加密传输。
        -   **HTTP**：HTTP协议具有以下特性：
            -   面向连接的协议，可靠性高。在正式收发数据前，必须和对方建立可靠的连接。
            -   数据传输快。
            -   数据明文传输。 |
        |**端口**|用来接收请求并向终端节点进行转发的监听端口，端口取值范围：**1~65499**。HTTP或HTTPS协议的监听只支持配置一个监听端口。 |
        |**客户端亲和性**|选择是否保持客户端亲和性：         -   **源IP**：保持客户端亲和性，即客户端访问有状态的应用程序时，可以将来自同一客户端的所有请求都定向到同一终端节点。
        -   **关闭**：不保持客户端亲和性，即不能确保来自同一客户端的连接请求始终定向到同一终端节点。 |

2.  （可选）配置SSL证书

    您只有在配置基于HTTPS协议的监听时，才需要添加服务器SSL证书。SSL证书为全球加速加密传输数据提供保障。

    1.  在**配置SSL证书**页面，选择您已经申请的SSL证书。

    2.  单击**下一步**配置终端节点。

3.  配置终端节点组。

    每个监听都有与之关联的终端节点组，您通过指定要向其分发流量的区域，将终端节点组与监听相关联，系统自动将流量分配到与监听关联的终端节点组内的最佳终端节点。

    1.  根据以下信息，配置终端节点。

        |配置|说明|
        |--|--|
        |**节点组名称**|输入终端节点组的名称。 名称长度为2~128个字符，以大小写字母或中文开头，可包含数字、下划线（\_）和短划线（-）。 |
        |**地域**|选择终端节点组所属的地域。|
        |**后端服务部署在**|选择后端服务器部署地。         -   **阿里云**：后端服务器部署在阿里云。
        -   **非阿里云**：后端服务器部署在非阿里云。 |
        |**保持客户端源IP**|开启或关闭保持客户端源IP。 开启后，后端服务器可以通过该功能获取客户端源IP。更多信息，请参见[保持客户端源IP](/intl.zh-CN/监控与运维/保持客户端源IP.md)。

**说明：** 目前，保持客户端源IP功能白名单开放，如需使用请[提交工单](https://workorder-intl.console.aliyun.com/?spm=5176.11182188.console-base-top.dworkorder.18ae4882n3v6ZW#/ticket/createIndex)。 |
        |**终端节点**|终端节点是客户端请求访问的目标主机。您可以根据以下信息配置终端节点：         -   **后端服务类型**：如果您的服务部署在阿里云，您可以选择**阿里云公网IP**、**ECS**或**SLB**；如果您的服务部署在非阿里云，您可以选择**自定义IP**或**自定义域名**。

**说明：**

            -   目前，选择ECS和SLB作为后端服务类型的功能白名单开放。如需使用，请[提交工单](https://workorder-intl.console.aliyun.com/?spm=5176.11182188.console-base-top.dworkorder.18ae4882n3v6ZW#/ticket/createIndex)。
            -   选择ECS和SLB作为后端服务类型，如果服务关联角色不存在，系统会自动创建一个名称为AliyunServiceRoleForGaVpcEndpoint的服务关联角色。更多信息，请参见[AliyunServiceRoleForGaVpcEndpoint](/intl.zh-CN/用户指南/服务关联角色/AliyunServiceRoleForGaVpcEndpoint.md)。
        -   **后端服务**：输入后端服务器提供服务的IP地址或域名。
        -   **权重**：输入终端节点权重，权重取值范围：**0~255**。全球加速根据您配置的权重按比例将流量路由到终端节点。

**说明：** 如果某个终端节点的权重设置为0，全球加速将终止向该终端节点分发流量，请您谨慎操作。

您可以单击**+添加节点**添加多个终端节点，最多添加4个终端节点。 |
        |**后端服务协议**|选择后端服务器使用的服务协议：        -   **HTTP**（默认值）
        -   **HTTPS**
**说明：**

        -   当您的监听协议为HTTP时，默认您的后端服务器使用HTTP服务协议，且不支持更改。
        -   您只有在配置HTTP或HTTPS协议监听的终端节点组时，才允许配置**后端服务协议**和**端口映射**参数。 |
        |**端口映射**|当您监听的端口和您终端节点提供服务的端口不相同时，您需要输入端口映射关系。        -   **监听端口**：只能填写当前监听的端口。
        -   **终端节点端口**：您终端节点提供服务的端口。
如果您监听的端口和您终端节点提供服务的端口相同，您无需填写端口映射关系，全球加速自动将访问请求发送至终端节点的监听端口。 |

    2.  单击**下一步**。

4.  审核配置。

    1.  在**配置审核**页面下，审核配置。

        如果需要修改配置，您可以单击对应区域中的**修改**，返回到之前的配置页面进行修改。

    2.  确认无误后，单击**提交**，完成监听配置。


**说明：** 在您配置HTTP或HTTPS协议的监听后，您可以为该监听配置虚拟终端节点组和转发策略，配置后全球加速可同时加速多个域名或路径访问您后端的HTTP或HTTPS服务。具体操作，请参见[添加终端节点组](/intl.zh-CN/用户指南/终端节点组与终端节点/设置终端节点组.md)和[转发策略]()。

更多信息，请参见[单个全球加速实例加速访问多个HTTPS域名](/intl.zh-CN/最佳实践/单个全球加速实例加速访问多个HTTPS域名.md)。

**相关文档**  


[CreateListener](/intl.zh-CN/API参考/监听/CreateListener.md)

